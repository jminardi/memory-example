function runFilter(t,a,e,r,n){var i,o=document.getElementById(t),l=o.previousSibling.style,h=o.parentNode.getElementsByTagName("button")[0];null==h.originalText&&(h.originalText=h.textContent),"none"==l.display?(l.display="inline",o.style.display="none",h.textContent=h.originalText):(i=Filters.filterImage(a,img,e,r,n),o.width=i.width,o.height=i.height,o.getContext("2d").putImageData(i,0,0),l.display="none",o.style.display="inline",h.textContent="Restore original image")}Filters={getPixels:function(t){var a,e;if(t.getContext){a=t;try{e=a.getContext("2d")}catch(t){}}return e||(e=(a=this.getCanvas(t.width,t.height)).getContext("2d")).drawImage(t,0,0),e.getImageData(0,0,a.width,a.height)},getCanvas:function(t,a){var e=document.createElement("canvas");return e.width=t,e.height=a,e},filterImage:function(t,a,e){for(var r=[this.getPixels(a)],n=2;n<arguments.length;n++)r.push(arguments[n]);return t.apply(null,r)},grayscale:function(t,a){for(var e=t.data,r=0;r<e.length;r+=4){var n=.2126*e[r]+.7152*e[r+1]+.0722*e[r+2];e[r]=e[r+1]=e[r+2]=n}return t},brightness:function(t,a){for(var e=t.data,r=0;r<e.length;r+=4)e[r]+=a,e[r+1]+=a,e[r+2]+=a;return t},threshold:function(t,a){for(var e=t.data,r=0;r<e.length;r+=4){var n=a<=.2126*e[r]+.7152*e[r+1]+.0722*e[r+2]?255:0;e[r]=e[r+1]=e[r+2]=n}return t},invert:function(t,a){for(var e=t.data,r=0;r<e.length;r+=4)e[r]=255-e[r],e[r+1]=255-e[r+1],e[r+2]=255-e[r+2];return t}},Filters.tmpCanvas=document.createElement("canvas"),Filters.tmpCtx=Filters.tmpCanvas.getContext("2d"),Filters.createImageData=function(t,a){return this.tmpCtx.createImageData(t,a)},Filters.convolute=function(t,a,e){for(var r=Math.round(Math.sqrt(a.length)),n=Math.floor(r/2),i=t.data,o=t.width,l=t.height,h=o,g=l,s=Filters.createImageData(h,g),d=s.data,u=e?1:0,v=0;v<g;v++)for(var c=0;c<h;c++){for(var f=v,m=c,F=4*(v*h+c),x=0,y=0,M=0,p=0,C=0;C<r;C++)for(var w=0;w<r;w++){var I=4*(Math.min(l-1,Math.max(0,f+C-n))*o+Math.min(o-1,Math.max(0,m+w-n))),b=a[C*r+w];x+=i[I]*b,y+=i[1+I]*b,M+=i[2+I]*b,p+=i[3+I]*b}d[F]=x,d[1+F]=y,d[2+F]=M,d[3+F]=p+u*(255-p)}return s},window.Float32Array||(Float32Array=Array),Filters.convoluteFloat32=function(t,a,e){for(var r=Math.round(Math.sqrt(a.length)),n=Math.floor(r/2),i=t.data,o=t.width,l=t.height,h=o,g=l,s={width:h,height:g,data:new Float32Array(h*g*4)},d=s.data,u=e?1:0,v=0;v<g;v++)for(var c=0;c<h;c++){for(var f=v,m=c,F=4*(v*h+c),x=0,y=0,M=0,p=0,C=0;C<r;C++)for(var w=0;w<r;w++){var I=4*(Math.min(l-1,Math.max(0,f+C-n))*o+Math.min(o-1,Math.max(0,m+w-n))),b=a[C*r+w];x+=i[I]*b,y+=i[1+I]*b,M+=i[2+I]*b,p+=i[3+I]*b}d[F]=x,d[1+F]=y,d[2+F]=M,d[3+F]=p+u*(255-p)}return s},sobel=function(){runFilter("sobel",function(t){t=Filters.grayscale(t);for(var a=Filters.convoluteFloat32(t,[-1,-2,-1,0,0,0,1,2,1]),e=Filters.convoluteFloat32(t,[-1,0,1,-2,0,2,-1,0,1]),r=Filters.createImageData(a.width,a.height),n=0;n<r.data.length;n+=4){var i=Math.abs(a.data[n]);r.data[n]=i;var o=Math.abs(e.data[n]);r.data[n+1]=o,r.data[n+2]=(i+o)/4,r.data[n+3]=255}return r})};