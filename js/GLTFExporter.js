console.warn("THREE.GLTFExporter: As part of the transition to ES6 Modules, the files in 'examples/js' were deprecated in May 2020 (r117) and will be deleted in December 2020 (r124). You can find more information about developing using ES6 Modules in https://threejs.org/docs/#manual/en/introduction/Installation.");var WEBGL_CONSTANTS={POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6,UNSIGNED_BYTE:5121,UNSIGNED_SHORT:5123,FLOAT:5126,UNSIGNED_INT:5125,ARRAY_BUFFER:34962,ELEMENT_ARRAY_BUFFER:34963,NEAREST:9728,LINEAR:9729,NEAREST_MIPMAP_NEAREST:9984,LINEAR_MIPMAP_NEAREST:9985,NEAREST_MIPMAP_LINEAR:9986,LINEAR_MIPMAP_LINEAR:9987,CLAMP_TO_EDGE:33071,MIRRORED_REPEAT:33648,REPEAT:10497},THREE_TO_WEBGL={};THREE_TO_WEBGL[THREE.NearestFilter]=WEBGL_CONSTANTS.NEAREST,THREE_TO_WEBGL[THREE.NearestMipmapNearestFilter]=WEBGL_CONSTANTS.NEAREST_MIPMAP_NEAREST,THREE_TO_WEBGL[THREE.NearestMipmapLinearFilter]=WEBGL_CONSTANTS.NEAREST_MIPMAP_LINEAR,THREE_TO_WEBGL[THREE.LinearFilter]=WEBGL_CONSTANTS.LINEAR,THREE_TO_WEBGL[THREE.LinearMipmapNearestFilter]=WEBGL_CONSTANTS.LINEAR_MIPMAP_NEAREST,THREE_TO_WEBGL[THREE.LinearMipmapLinearFilter]=WEBGL_CONSTANTS.LINEAR_MIPMAP_LINEAR,THREE_TO_WEBGL[THREE.ClampToEdgeWrapping]=WEBGL_CONSTANTS.CLAMP_TO_EDGE,THREE_TO_WEBGL[THREE.RepeatWrapping]=WEBGL_CONSTANTS.REPEAT,THREE_TO_WEBGL[THREE.MirroredRepeatWrapping]=WEBGL_CONSTANTS.MIRRORED_REPEAT;var PATH_PROPERTIES={scale:"scale",position:"translation",quaternion:"rotation",morphTargetInfluences:"weights"};THREE.GLTFExporter=function(){},THREE.GLTFExporter.prototype={constructor:THREE.GLTFExporter,parse:function(e,p,c){var t={binary:!1,trs:!1,onlyVisible:!0,truncateDrawRange:!0,embedImages:!0,maxTextureSize:1/0,animations:[],forcePowerOfTwoTextures:!1,includeCustomExtensions:!1};0<(c=Object.assign({},t,c)).animations.length&&(c.trs=!0);var E,C={asset:{version:"2.0",generator:"THREE.GLTFExporter"}},m=0,r=[],f=[],T=new Map,h=[],P={},U={meshes:new Map,attributes:new Map,attributesNormalized:new Map,materials:new Map,textures:new Map,images:new Map},a=new Map,n=0;function W(e){return a.has(e)||a.set(e,n++),a.get(e)}function D(e,r){return e.length===r.length&&e.every(function(e,t){return e===r[t]})}function g(e){return 4*Math.ceil(e/4)}function d(e,t){t=t||0;var r=g(e.byteLength);if(r===e.byteLength)return e;var a=new Uint8Array(r);if(a.set(new Uint8Array(e)),0!==t)for(var n=e.byteLength;n<r;n++)a[n]=t;return a.buffer}function z(t,e){if(0!==Object.keys(t.userData).length)try{var r=JSON.parse(JSON.stringify(t.userData));if(c.includeCustomExtensions&&r.gltfExtensions){for(var a in void 0===e.extensions&&(e.extensions={}),r.gltfExtensions)e.extensions[a]=r.gltfExtensions[a],P[a]=!0;delete r.gltfExtensions}0<Object.keys(r).length&&(e.extras=r)}catch(e){console.warn("THREE.GLTFExporter: userData of '"+t.name+"' won't be serialized because of JSON.stringify error - "+e.message)}}function k(e,t){var r=!1,a={};0===t.offset.x&&0===t.offset.y||(a.offset=t.offset.toArray(),r=!0),0!==t.rotation&&(a.rotation=t.rotation,r=!0),1===t.repeat.x&&1===t.repeat.y||(a.scale=t.repeat.toArray(),r=!0),r&&(e.extensions=e.extensions||{},e.extensions.KHR_texture_transform=a,P.KHR_texture_transform=!0)}function R(e){return C.buffers||(C.buffers=[{byteLength:0}]),r.push(e),0}function V(e,t,r,a){var n,s,i;if(e.array.constructor===Float32Array)n=WEBGL_CONSTANTS.FLOAT;else if(e.array.constructor===Uint32Array)n=WEBGL_CONSTANTS.UNSIGNED_INT;else if(e.array.constructor===Uint16Array)n=WEBGL_CONSTANTS.UNSIGNED_SHORT;else{if(e.array.constructor!==Uint8Array)throw new Error("THREE.GLTFExporter: Unsupported bufferAttribute component type.");n=WEBGL_CONSTANTS.UNSIGNED_BYTE}if(void 0===r&&(r=0),void 0===a&&(a=e.count),c.truncateDrawRange&&void 0!==t&&null===t.index&&(s=r+a,i=t.drawRange.count===1/0?e.count:t.drawRange.start+t.drawRange.count,r=Math.max(r,t.drawRange.start),(a=Math.min(s,i)-r)<0&&(a=0)),0===a)return null;var o,l=function(e,t,r){for(var a={min:new Array(e.itemSize).fill(Number.POSITIVE_INFINITY),max:new Array(e.itemSize).fill(Number.NEGATIVE_INFINITY)},n=t;n<t+r;n++)for(var s=0;s<e.itemSize;s++){var i=e.array[n*e.itemSize+s];a.min[s]=Math.min(a.min[s],i),a.max[s]=Math.max(a.max[s],i)}return a}(e,r,a);void 0!==t&&(o=e===t.index?WEBGL_CONSTANTS.ELEMENT_ARRAY_BUFFER:WEBGL_CONSTANTS.ARRAY_BUFFER);var u=function(e,t,r,a,n){var s;C.bufferViews||(C.bufferViews=[]),s=t===WEBGL_CONSTANTS.UNSIGNED_BYTE?1:t===WEBGL_CONSTANTS.UNSIGNED_SHORT?2:4;for(var i=g(a*e.itemSize*s),o=new DataView(new ArrayBuffer(i)),l=0,u=r;u<r+a;u++)for(var p,E=0;E<e.itemSize;E++){4<e.itemSize?p=e.array[u*e.itemSize+E]:0===E?p=e.getX(u):1===E?p=e.getY(u):2===E?p=e.getZ(u):3===E&&(p=e.getW(u)),t===WEBGL_CONSTANTS.FLOAT?o.setFloat32(l,p,!0):t===WEBGL_CONSTANTS.UNSIGNED_INT?o.setUint32(l,p,!0):t===WEBGL_CONSTANTS.UNSIGNED_SHORT?o.setUint16(l,p,!0):t===WEBGL_CONSTANTS.UNSIGNED_BYTE&&o.setUint8(l,p),l+=s}var c={buffer:R(o.buffer),byteOffset:m,byteLength:i};return void 0!==n&&(c.target=n),n===WEBGL_CONSTANTS.ARRAY_BUFFER&&(c.byteStride=e.itemSize*s),m+=i,C.bufferViews.push(c),{id:C.bufferViews.length-1,byteLength:0}}(e,n,r,a,o),p={bufferView:u.id,byteOffset:u.byteOffset,componentType:n,count:a,max:l.max,min:l.min,type:{1:"SCALAR",2:"VEC2",3:"VEC3",4:"VEC4",16:"MAT4"}[e.itemSize]};return!0===e.normalized&&(p.normalized=!0),C.accessors||(C.accessors=[]),C.accessors.push(p),C.accessors.length-1}function s(e,t,r){U.images.has(e)||U.images.set(e,{});var a=U.images.get(e),n=t===THREE.RGBAFormat?"image/png":"image/jpeg",s=n+":flipY/"+r.toString();if(void 0!==a[s])return a[s];C.images||(C.images=[]);var i,o,l,u={mimeType:n};c.embedImages?((i=E=E||document.createElement("canvas")).width=Math.min(e.width,c.maxTextureSize),i.height=Math.min(e.height,c.maxTextureSize),!c.forcePowerOfTwoTextures||(l=i,THREE.MathUtils.isPowerOfTwo(l.width)&&THREE.MathUtils.isPowerOfTwo(l.height))||(console.warn("GLTFExporter: Resized non-power-of-two image.",e),i.width=THREE.MathUtils.floorPowerOfTwo(i.width),i.height=THREE.MathUtils.floorPowerOfTwo(i.height)),o=i.getContext("2d"),!0===r&&(o.translate(0,i.height),o.scale(1,-1)),o.drawImage(e,0,0,i.width,i.height),!0===c.binary?f.push(new Promise(function(r){i.toBlob(function(e){var t;t=e,C.bufferViews||(C.bufferViews=[]),new Promise(function(r){var a=new window.FileReader;a.readAsArrayBuffer(t),a.onloadend=function(){var e=d(a.result),t={buffer:R(e),byteOffset:m,byteLength:e.byteLength};m+=e.byteLength,C.bufferViews.push(t),r(C.bufferViews.length-1)}}).then(function(e){u.bufferView=e,r()})},n)})):u.uri=i.toDataURL(n)):u.uri=e.src,C.images.push(u);var p=C.images.length-1;return a[s]=p}function K(e){if(U.textures.has(e))return U.textures.get(e);C.textures||(C.textures=[]);var t={sampler:function(e){C.samplers||(C.samplers=[]);var t={magFilter:THREE_TO_WEBGL[e.magFilter],minFilter:THREE_TO_WEBGL[e.minFilter],wrapS:THREE_TO_WEBGL[e.wrapS],wrapT:THREE_TO_WEBGL[e.wrapT]};return C.samplers.push(t),C.samplers.length-1}(e),source:s(e.image,e.format,e.flipY)};e.name&&(t.name=e.name),C.textures.push(t);var r=C.textures.length-1;return U.textures.set(e,r),r}function S(e){var t=[e.geometry.uuid];if(Array.isArray(e.material))for(var r=0,a=e.material.length;r<a;r++)t.push(e.material[r].uuid);else t.push(e.material.uuid);var n=t.join(":");if(U.meshes.has(n))return U.meshes.get(n);var s=e.geometry,i=e.isLineSegments?WEBGL_CONSTANTS.LINES:e.isLineLoop?WEBGL_CONSTANTS.LINE_LOOP:e.isLine?WEBGL_CONSTANTS.LINE_STRIP:e.isPoints?WEBGL_CONSTANTS.POINTS:e.material.wireframe?WEBGL_CONSTANTS.LINES:WEBGL_CONSTANTS.TRIANGLES;s.isBufferGeometry||(console.warn("GLTFExporter: Exporting THREE.Geometry will increase file size. Use THREE.BufferGeometry instead."),s=(new THREE.BufferGeometry).setFromObject(e));var o={},l={},u=[],p=[],E={uv:"TEXCOORD_0",uv2:"TEXCOORD_1",color:"COLOR_0",skinWeight:"WEIGHTS_0",skinIndex:"JOINTS_0"},c=s.getAttribute("normal");void 0===c||function(e){if(!U.attributesNormalized.has(e)){for(var t=new THREE.Vector3,r=0,a=e.count;r<a;r++)if(5e-4<Math.abs(t.fromArray(e.array,3*r).length()-1))return;return 1}}(c)||(console.warn("THREE.GLTFExporter: Creating normalized normal attribute from the non-normalized one."),s.setAttribute("normal",function(e){if(U.attributesNormalized.has(e))return U.attributesNormalized.get(e);for(var t=e.clone(),r=new THREE.Vector3,a=0,n=t.count;a<n;a++)r.fromArray(t.array,3*a),0===r.x&&0===r.y&&0===r.z?r.setX(1):r.normalize(),r.toArray(t.array,3*a);return U.attributesNormalized.set(e,t),t}(c)));var m,f,T=null;for(var h in s.attributes){"morph"!==h.substr(0,5)&&(y=s.attributes[h],h=E[h]||h.toUpperCase(),/^(POSITION|NORMAL|TANGENT|TEXCOORD_\d+|COLOR_\d+|JOINTS_\d+|WEIGHTS_\d+)$/.test(h)||(h="_"+h),U.attributes.has(W(y))?l[h]=U.attributes.get(W(y)):(T=null,m=y.array,"JOINTS_0"!==h||m instanceof Uint16Array||m instanceof Uint8Array||(console.warn('GLTFExporter: Attribute "skinIndex" converted to type UNSIGNED_SHORT.'),T=new THREE.BufferAttribute(new Uint16Array(m),y.itemSize,y.normalized)),null!==(f=V(T||y,s))&&(l[h]=f,U.attributes.set(W(y),f))))}if(void 0!==c&&s.setAttribute("normal",c),0===Object.keys(l).length)return null;if(void 0!==e.morphTargetInfluences&&0<e.morphTargetInfluences.length){var g=[],d=[],R={};if(void 0!==e.morphTargetDictionary)for(var S in e.morphTargetDictionary)R[e.morphTargetDictionary[S]]=S;for(r=0;r<e.morphTargetInfluences.length;++r){var N={},v=!1;for(var h in s.morphAttributes)if("position"===h||"normal"===h){var y=s.morphAttributes[h][r],A=h.toUpperCase(),L=s.attributes[h];if(U.attributes.has(W(y)))N[A]=U.attributes.get(W(y));else{var _=y.clone();if(!s.morphTargetsRelative)for(var b=0,w=y.count;b<w;b++)_.setXYZ(b,y.getX(b)-L.getX(b),y.getY(b)-L.getY(b),y.getZ(b)-L.getZ(b));N[A]=V(_,s),U.attributes.set(W(L),N[A])}}else v||(console.warn("GLTFExporter: Only POSITION and NORMAL morph are supported."),v=!0);p.push(N),g.push(e.morphTargetInfluences[r]),void 0!==e.morphTargetDictionary&&d.push(R[r])}o.weights=g,0<d.length&&(o.extras={},o.extras.targetNames=d)}var x=Array.isArray(e.material);if(x&&0===s.groups.length)return null;for(var M=x?e.material:[e.material],I=x?s.groups:[{materialIndex:0,start:void 0,count:void 0}],r=0,G=I.length;r<G;r++){var O,H={mode:i,attributes:l};z(s,H),0<p.length&&(H.targets=p),null!==s.index&&(O=W(s.index),void 0===I[r].start&&void 0===I[r].count||(O+=":"+I[r].start+":"+I[r].count),U.attributes.has(O)?H.indices=U.attributes.get(O):(H.indices=V(s.index,s,I[r].start,I[r].count),U.attributes.set(O,H.indices)),null===H.indices&&delete H.indices);var B=function(e){if(U.materials.has(e))return U.materials.get(e);if(e.isShaderMaterial)return console.warn("GLTFExporter: THREE.ShaderMaterial not supported."),null;C.materials||(C.materials=[]);var t={pbrMetallicRoughness:{}};e.isMeshBasicMaterial?(t.extensions={KHR_materials_unlit:{}},P.KHR_materials_unlit=!0):e.isGLTFSpecularGlossinessMaterial?(t.extensions={KHR_materials_pbrSpecularGlossiness:{}},P.KHR_materials_pbrSpecularGlossiness=!0):e.isMeshStandardMaterial||console.warn("GLTFExporter: Use MeshStandardMaterial or MeshBasicMaterial for best results.");var r,a,n,s,i,o,l,u,p=e.color.toArray().concat([e.opacity]);D(p,[1,1,1,1])||(t.pbrMetallicRoughness.baseColorFactor=p),e.isMeshStandardMaterial?(t.pbrMetallicRoughness.metallicFactor=e.metalness,t.pbrMetallicRoughness.roughnessFactor=e.roughness):e.isMeshBasicMaterial?(t.pbrMetallicRoughness.metallicFactor=0,t.pbrMetallicRoughness.roughnessFactor=.9):(t.pbrMetallicRoughness.metallicFactor=.5,t.pbrMetallicRoughness.roughnessFactor=.5),e.isGLTFSpecularGlossinessMaterial&&(t.pbrMetallicRoughness.baseColorFactor&&(t.extensions.KHR_materials_pbrSpecularGlossiness.diffuseFactor=t.pbrMetallicRoughness.baseColorFactor),r=[1,1,1],e.specular.toArray(r,0),t.extensions.KHR_materials_pbrSpecularGlossiness.specularFactor=r,t.extensions.KHR_materials_pbrSpecularGlossiness.glossinessFactor=e.glossiness),(e.metalnessMap||e.roughnessMap)&&(e.metalnessMap===e.roughnessMap?(k(a={index:K(e.metalnessMap)},e.metalnessMap),t.pbrMetallicRoughness.metallicRoughnessTexture=a):console.warn("THREE.GLTFExporter: Ignoring metalnessMap and roughnessMap because they are not the same Texture.")),e.map&&(k(n={index:K(e.map)},e.map),e.isGLTFSpecularGlossinessMaterial&&(t.extensions.KHR_materials_pbrSpecularGlossiness.diffuseTexture=n),t.pbrMetallicRoughness.baseColorTexture=n),e.isGLTFSpecularGlossinessMaterial&&e.specularMap&&(k(s={index:K(e.specularMap)},e.specularMap),t.extensions.KHR_materials_pbrSpecularGlossiness.specularGlossinessTexture=s),e.emissive&&(D(i=e.emissive.clone().multiplyScalar(e.emissiveIntensity).toArray(),[0,0,0])||(t.emissiveFactor=i),e.emissiveMap&&(k(o={index:K(e.emissiveMap)},e.emissiveMap),t.emissiveTexture=o)),e.normalMap&&(l={index:K(e.normalMap)},e.normalScale&&-1!==e.normalScale.x&&(e.normalScale.x!==e.normalScale.y&&console.warn("THREE.GLTFExporter: Normal scale components are different, ignoring Y and exporting X."),l.scale=e.normalScale.x),k(l,e.normalMap),t.normalTexture=l),e.aoMap&&(u={index:K(e.aoMap),texCoord:1},1!==e.aoMapIntensity&&(u.strength=e.aoMapIntensity),k(u,e.aoMap),t.occlusionTexture=u),e.transparent?t.alphaMode="BLEND":0<e.alphaTest&&(t.alphaMode="MASK",t.alphaCutoff=e.alphaTest),e.side===THREE.DoubleSide&&(t.doubleSided=!0),""!==e.name&&(t.name=e.name),z(e,t),C.materials.push(t);var E=C.materials.length-1;return U.materials.set(e,E),E}(M[I[r].materialIndex]);null!==B&&(H.material=B),u.push(H)}o.primitives=u,C.meshes||(C.meshes=[]),C.meshes.push(o);var F=C.meshes.length-1;return U.meshes.set(n,F),F}function N(e){C.nodes||(C.nodes=[]);var t,r,a,n={};if(c.trs?(t=e.quaternion.toArray(),r=e.position.toArray(),a=e.scale.toArray(),D(t,[0,0,0,1])||(n.rotation=t),D(r,[0,0,0])||(n.translation=r),D(a,[1,1,1])||(n.scale=a)):(e.matrixAutoUpdate&&e.updateMatrix(),D(e.matrix.elements,[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])||(n.matrix=e.matrix.elements)),""!==e.name&&(n.name=String(e.name)),z(e,n),e.isMesh||e.isLine||e.isPoints){var s=S(e);null!==s&&(n.mesh=s)}else if(e.isCamera)n.camera=function(e){C.cameras||(C.cameras=[]);var t=e.isOrthographicCamera,r={type:t?"orthographic":"perspective"};return t?r.orthographic={xmag:2*e.right,ymag:2*e.top,zfar:e.far<=0?.001:e.far,znear:e.near<0?0:e.near}:r.perspective={aspectRatio:e.aspect,yfov:THREE.MathUtils.degToRad(e.fov),zfar:e.far<=0?.001:e.far,znear:e.near<0?0:e.near},""!==e.name&&(r.name=e.type),C.cameras.push(r),C.cameras.length-1}(e);else if(e.isDirectionalLight||e.isPointLight||e.isSpotLight)P.KHR_lights_punctual||(C.extensions=C.extensions||{},C.extensions.KHR_lights_punctual={lights:[]},P.KHR_lights_punctual=!0),n.extensions=n.extensions||{},n.extensions.KHR_lights_punctual={light:function(e){var t={};e.name&&(t.name=e.name),t.color=e.color.toArray(),t.intensity=e.intensity,e.isDirectionalLight?t.type="directional":e.isPointLight?(t.type="point",0<e.distance&&(t.range=e.distance)):e.isSpotLight&&(t.type="spot",0<e.distance&&(t.range=e.distance),t.spot={},t.spot.innerConeAngle=(e.penumbra-1)*e.angle*-1,t.spot.outerConeAngle=e.angle),void 0!==e.decay&&2!==e.decay&&console.warn("THREE.GLTFExporter: Light decay may be lost. glTF is physically-based, and expects light.decay=2."),!e.target||e.target.parent===e&&0===e.target.position.x&&0===e.target.position.y&&-1===e.target.position.z||console.warn("THREE.GLTFExporter: Light direction may be lost. For best results, make light.target a child of the light with position 0,0,-1.");var r=C.extensions.KHR_lights_punctual.lights;return r.push(t),r.length-1}(e)};else if(e.isLight)return console.warn("THREE.GLTFExporter: Only directional, point, and spot lights are supported.",e),null;if(e.isSkinnedMesh&&h.push(e),0<e.children.length){for(var i=[],o=0,l=e.children.length;o<l;o++){var u,p=e.children[o];!p.visible&&!1!==c.onlyVisible||null!==(u=N(p))&&i.push(u)}0<i.length&&(n.children=i)}C.nodes.push(n);var E=C.nodes.length-1;return T.set(e,E),E}function i(e){C.scenes||(C.scenes=[],C.scene=0);var t={};""!==e.name&&(t.name=e.name),C.scenes.push(t);for(var r=[],a=0,n=e.children.length;a<n;a++){var s,i=e.children[a];!i.visible&&!1!==c.onlyVisible||null!==(s=N(i))&&r.push(s)}0<r.length&&(t.nodes=r),z(e,t)}!function(e){e=e instanceof Array?e:[e];for(var t=[],r=0;r<e.length;r++)e[r]instanceof THREE.Scene?i(e[r]):t.push(e[r]);for(0<t.length&&function(e){var t=new THREE.Scene;t.name="AuxScene";for(var r=0;r<e.length;r++)t.children.push(e[r]);i(t)}(t),r=0;r<h.length;++r)!function(e){var t=C.nodes[T.get(e)],r=e.skeleton;if(void 0!==r){var a=e.skeleton.bones[0];if(void 0!==a){for(var n=[],s=new Float32Array(16*r.bones.length),i=0;i<r.bones.length;++i)n.push(T.get(r.bones[i])),r.boneInverses[i].toArray(s,16*i);void 0===C.skins&&(C.skins=[]),C.skins.push({inverseBindMatrices:V(new THREE.BufferAttribute(s,16)),joints:n,skeleton:T.get(a)}),t.skin=C.skins.length-1}}}(h[r]);for(r=0;r<c.animations.length;++r)!function(e,t){C.animations||(C.animations=[]);for(var r=(e=THREE.GLTFExporter.Utils.mergeMorphTargetTracks(e.clone(),t)).tracks,a=[],n=[],s=0;s<r.length;++s){var i=r[s],o=THREE.PropertyBinding.parseTrackName(i.name),l=THREE.PropertyBinding.findNode(t,o.nodeName),u=PATH_PROPERTIES[o.propertyName];if("bones"===o.objectName&&(l=!0===l.isSkinnedMesh?l.skeleton.getBoneByName(o.objectIndex):void 0),!l||!u)return console.warn('THREE.GLTFExporter: Could not export animation track "%s".',i.name);var p,E=i.values.length/i.times.length;u===PATH_PROPERTIES.morphTargetInfluences&&(E/=l.morphTargetInfluences.length),!0===i.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline?(p="CUBICSPLINE",E/=3):p=i.getInterpolation()===THREE.InterpolateDiscrete?"STEP":"LINEAR",n.push({input:V(new THREE.BufferAttribute(i.times,1)),output:V(new THREE.BufferAttribute(i.values,E)),interpolation:p}),a.push({sampler:n.length-1,target:{node:T.get(l),path:u}})}C.animations.push({name:e.name||"clip_"+C.animations.length,samplers:n,channels:a}),C.animations.length}(c.animations[r],e[0])}(e),Promise.all(f).then(function(){var u,e=new Blob(r,{type:"application/octet-stream"}),t=Object.keys(P);0<t.length&&(C.extensionsUsed=t),C.buffers&&0<C.buffers.length&&(C.buffers[0].byteLength=e.size),!0===c.binary?((u=new window.FileReader).readAsArrayBuffer(e),u.onloadend=function(){var e=d(u.result),t=new DataView(new ArrayBuffer(8));t.setUint32(0,e.byteLength,!0),t.setUint32(4,5130562,!0);var r=d(function(e){if(void 0!==window.TextEncoder)return(new TextEncoder).encode(e).buffer;for(var t=new Uint8Array(new ArrayBuffer(e.length)),r=0,a=e.length;r<a;r++){var n=e.charCodeAt(r);t[r]=255<n?32:n}return t.buffer}(JSON.stringify(C)),32),a=new DataView(new ArrayBuffer(8));a.setUint32(0,r.byteLength,!0),a.setUint32(4,1313821514,!0);var n=new ArrayBuffer(12),s=new DataView(n);s.setUint32(0,1179937895,!0),s.setUint32(4,2,!0);var i=12+a.byteLength+r.byteLength+t.byteLength+e.byteLength;s.setUint32(8,i,!0);var o=new Blob([n,a,r,t,e],{type:"application/octet-stream"}),l=new window.FileReader;l.readAsArrayBuffer(o),l.onloadend=function(){p(l.result)}}):C.buffers&&0<C.buffers.length?((u=new window.FileReader).readAsDataURL(e),u.onloadend=function(){var e=u.result;C.buffers[0].uri=e,p(C)}):p(C)})}},THREE.GLTFExporter.Utils={insertKeyframe:function(e,t){var r,a=e.getValueSize(),n=new e.TimeBufferType(e.times.length+1),s=new e.ValueBufferType(e.values.length+a),i=e.createInterpolant(new e.ValueBufferType(a));if(0===e.times.length){n[0]=t;for(var o=0;o<a;o++)s[o]=0;r=0}else if(t<e.times[0]){if(Math.abs(e.times[0]-t)<.001)return 0;n[0]=t,n.set(e.times,1),s.set(i.evaluate(t),0),s.set(e.values,a),r=0}else if(t>e.times[e.times.length-1]){if(Math.abs(e.times[e.times.length-1]-t)<.001)return e.times.length-1;n[n.length-1]=t,n.set(e.times,0),s.set(e.values,0),s.set(i.evaluate(t),e.values.length),r=n.length-1}else for(o=0;o<e.times.length;o++){if(Math.abs(e.times[o]-t)<.001)return o;if(e.times[o]<t&&e.times[o+1]>t){n.set(e.times.slice(0,o+1),0),n[o+1]=t,n.set(e.times.slice(o+1),o+2),s.set(e.values.slice(0,(o+1)*a),0),s.set(i.evaluate(t),(o+1)*a),s.set(e.values.slice((o+1)*a),(o+2)*a),r=o+1;break}}return e.times=n,e.values=s,r},mergeMorphTargetTracks:function(e,t){for(var r=[],a={},n=e.tracks,s=0;s<n.length;++s){var i=n[s],o=THREE.PropertyBinding.parseTrackName(i.name),l=THREE.PropertyBinding.findNode(t,o.nodeName);if("morphTargetInfluences"===o.propertyName&&void 0!==o.propertyIndex){if(i.createInterpolant!==i.InterpolantFactoryMethodDiscrete&&i.createInterpolant!==i.InterpolantFactoryMethodLinear){if(i.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline)throw new Error("THREE.GLTFExporter: Cannot merge tracks with glTF CUBICSPLINE interpolation.");console.warn("THREE.GLTFExporter: Morph target interpolation mode not yet supported. Using LINEAR instead."),(i=i.clone()).setInterpolation(THREE.InterpolateLinear)}var u=l.morphTargetInfluences.length,p=l.morphTargetDictionary[o.propertyIndex];if(void 0===p)throw new Error("THREE.GLTFExporter: Morph target name not found: "+o.propertyIndex);if(void 0!==a[l.uuid]){for(var E=i.createInterpolant(new i.ValueBufferType(1)),c=a[l.uuid],m=0;m<c.times.length;m++)c.values[m*u+p]=E.evaluate(c.times[m]);for(m=0;m<i.times.length;m++){var f=this.insertKeyframe(c,i.times[m]);c.values[f*u+p]=i.values[m]}}else{for(var T=new((c=i.clone()).ValueBufferType)(u*c.times.length),m=0;m<c.times.length;m++)T[m*u+p]=c.values[m];c.name=o.nodeName+".morphTargetInfluences",c.values=T,a[l.uuid]=c,r.push(c)}}else r.push(i)}return e.tracks=r,e}};